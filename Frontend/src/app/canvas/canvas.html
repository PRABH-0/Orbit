<app-header
  [userState]="userState"
  [currentFolder]="currentFolderName"
  (addFolder)="onAddFolder()"
  (addItem)="onAddItem()"
  (delete)="onDeleteFolder()"
  (openProfile)="openUserMenu()">
</app-header>

<input
  type="file"
  #headerFileInput
  hidden
  (change)="onHeaderFileSelected($event)"
/>
<app-profile
  *ngIf="showProfile"
  [username]="username"
  (close)="closeProfile()"
  (logout)="logout()"
  (about)="aboutpage()"
  (payment)="payment()">
</app-profile>
  <div
    class="canvas-blur-overlay"
    *ngIf="showProfile"
    (click)="closeProfile()">
  </div>
<div class="grid" #grid>

  <!-- EDGES -->
  <svg class="edges">
    <line
      *ngFor="let e of getVisibleEdges()"
      appEdge
      [x1]="e.x1"
      [y1]="e.y1"
      [x2]="e.x2"
      [y2]="e.y2"
      [class.model-edge]="e.isModelEdge">
    </line>
  </svg>

  <!-- ROOT -->
  <div
    class="center-circle"
    #centerCircle
    (click)="toggleRoot()">
   <img
  class="user-avatar"
  [src]="profilePic"
  alt="User"
/>

  </div>

  <!-- DIRECTORIES -->
  <ng-container *ngFor="let dir of directories">
    <app-directory
      *ngIf="shouldShow(dir)"
      [name]="dir.name"
      [x]="dir.x"
      [y]="dir.y"
      (clicked)="onFolderClick(dir)"
      (moved)="onFolderMoved(dir, $event)">
    </app-directory>
  </ng-container>

  <app-model-data
  *ngIf="showModelData && dataNodePosition"
  [x]="dataNodePosition.x"
  [y]="dataNodePosition.y"
  [title]="currentFolderName"
  [items]="selectedFolderItems"
  [isGoogleFolder]="
  activeFolder?.storageProvider === 'GoogleDrive' ||
  activeFolder?.storageProvider === 'GooglePhotos'"
  [nodeId]="selectedFolderId"
  (fileUploaded)="reloadFiles()"
  (imageOpen)="openImage($event)"
  (closeNode)="closeModelData()">
</app-model-data>



</div>
<!-- ADD FOLDER MODAL -->
<div class="add-folder-modal" *ngIf="isAddFolderOpen">

  <h3>Add Folder</h3>

  <label>
    Folder Name
    <input type="text" [(ngModel)]="draftFolder.name" />
  </label>

  <label>
    X Position
    <input type="number" [(ngModel)]="draftFolder.x" />
  </label>

  <label>
    Y Position
    <input type="number" [(ngModel)]="draftFolder.y" />
  </label>

  <div class="actions">
    <button class="cancel" (click)="cancelAddFolder()">Cancel</button>
    <button class="save" (click)="saveAddFolder()">Save</button>
  </div>

</div>
<div
  class="file-viewer-overlay"
  *ngIf="selectedFile"
  (click)="closeFileViewer()"
><!-- FILE NAME -->
<div
  class="file-name"
  (click)="$event.stopPropagation()"
>
  {{ selectedFile.fileName }}
</div>

  <!-- TOOLBAR -->
  <div class="file-toolbar" (click)="$event.stopPropagation()">
    <button (click)="downloadFile()">â¬‡</button>
    <button (click)="deleteFile()">ðŸ—‘</button>
    <button (click)="closeFileViewer()">âœ•</button>
  </div>

  <!-- CENTERED CONTENT -->
  <div class="file-viewer-content" (click)="$event.stopPropagation()">

    <!-- IMAGE -->
    <!-- IMAGE -->
<div *ngIf="selectedFile.type === 'image'" class="image-wrapper">
  <img
    [src]="selectedFile.url"
    class="file-media"
  />
</div>


    <!-- VIDEO -->
    <video
      *ngIf="selectedFile.type === 'video'"
      controls
      class="file-media"
    >
      <source [src]="selectedFile.url" />
    </video>
    <!-- TEXT / CODE VIEWER -->
<pre
  *ngIf="selectedFile.type === 'text'"
  class="code-viewer"
>
{{ selectedFile.content }}
</pre>


    <!-- PDF -->
    <iframe
  *ngIf="selectedFile.type === 'pdf'"
  [src]="selectedFile.safeUrl" type="application/pdf"
  class="file-media pdf">
</iframe>

<div *ngIf="selectedFile.type === 'audio'" class="audio-wrapper">
  <audio controls>
    <source [src]="selectedFile.url" type="audio/mpeg" />

  </audio>
</div>

  </div>
</div>



