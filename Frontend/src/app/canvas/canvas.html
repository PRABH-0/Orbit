<app-header
  [username]="username"
  [currentFolder]="currentFolderName"
  (addFolder)="onAddFolder()"
  (addItem)="onAddItem()">
</app-header>


<div class="grid" #grid>

  <!-- EDGES -->
  <svg class="edges">
    <line
      *ngFor="let e of getVisibleEdges()"
      appEdge
      [x1]="e.x1"
      [y1]="e.y1"
      [x2]="e.x2"
      [y2]="e.y2"
      [class.model-edge]="e.isModelEdge">
    </line>
  </svg>

  <!-- ROOT -->
  <div
    class="center-circle"
    #centerCircle
    (click)="toggleRoot()">
    <img src="user_c.png" />
  </div>

  <!-- DIRECTORIES -->
  <ng-container *ngFor="let dir of directories">
    <app-directory
      *ngIf="shouldShow(dir)"
      [name]="dir.name"
      [x]="dir.x"
      [y]="dir.y"
      (clicked)="onFolderClick(dir)"
      (moved)="onFolderMoved(dir, $event)">
    </app-directory>
  </ng-container>

  <app-model-data
  *ngIf="showModelData && dataNodePosition"
  [x]="dataNodePosition.x"
  [y]="dataNodePosition.y"
  [title]="currentFolderName"
  [items]="selectedFolderItems"
  [nodeId]="selectedFolderId"
  (fileUploaded)="reloadFiles()"
  (imageOpen)="openImage($event)"
  (closeNode)="closeModelData()">
</app-model-data>



</div>

<!-- ADD FOLDER MODAL -->
<div class="add-folder-modal" *ngIf="isAddFolderOpen">

  <h3>Add Folder</h3>

  <label>
    Folder Name
    <input type="text" [(ngModel)]="draftFolder.name" />
  </label>

  <label>
    X Position
    <input type="number" [(ngModel)]="draftFolder.x" />
  </label>

  <label>
    Y Position
    <input type="number" [(ngModel)]="draftFolder.y" />
  </label>

  <div class="actions">
    <button class="cancel" (click)="cancelAddFolder()">Cancel</button>
    <button class="save" (click)="saveAddFolder()">Save</button>
  </div>

</div>

<!-- IMAGE VIEWER OVERLAY -->
<div
  class="image-overlay"
  *ngIf="selectedImage"
  (click)="closeImage()"
>

  <!-- TOP TOOLBAR -->
  <div class="image-toolbar" (click)="$event.stopPropagation()">
    <button title="Download" (click)="downloadImage()">â¬‡</button>
    <button title="Delete" (click)="deleteImage()">ðŸ—‘</button>
    <button title="Close" (click)="closeImage()">âœ•</button>
  </div>

  <!-- IMAGE -->
  <img
    class="image-preview"
    [src]="selectedImage"
    (click)="$event.stopPropagation()"
  />
</div>
